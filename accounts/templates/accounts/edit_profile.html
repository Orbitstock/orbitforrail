{% extends 'core/base.html' %}

{% block content %}
{% load static %}
{% include "core/messages.html" %}

                <div id="page-header-loader" class="overlay-header bg-body-extra-light">
                    <div class="content-header">
                        <div class="w-100 text-center">
                            <i class="fa fa-fw fa-circle-notch fa-spin"></i>
                        </div>
                    </div>
                </div>
            </header>
            <main id="main-container">
                <div class="bg-image" style="background-image: url('{% static 'images/photo10@2x.jpg' %}');">
                    <div class="bg-primary-dark-op">
                        <div class="content content-full text-center">
                            <div class="my-3">
                                <img class="img-avatar img-avatar-thumb proof-of-pay-link" src="{{ user.account.picture.url }}"  alt="Profile Picture" data-bs-toggle="tooltip" title="View Profile Picture" style="cursor: pointer;" /><br>
                                <small style="font-size:10px; color: white;"><p>Click To View</p></small>
                            </div>

                                        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

                                        <script>
                                            document.addEventListener('DOMContentLoaded', function() {
                                                const proofOfPayLinks = document.querySelectorAll(".proof-of-pay-link");
                                                proofOfPayLinks.forEach((link) => {
                                                    link.addEventListener("click", (e) => {
                                                        e.preventDefault();
                                                        const imageUrl = e.target.src;
                                                        Swal.fire({
                                                            html: `
                                                                <div class="custom-image-modal">
                                                                    <div class="image-wrapper">
                                                                        <img src="${imageUrl}" alt="Profile Picture">
                                                                    </div>
                                                                    <div class="image-caption">
                                                                        <p>Account Picture</p>
                                                                    </div>
                                                                </div>
                                                            `,
                                                            showConfirmButton: false,
                                                            showCloseButton: true,
                                                            customClass: {
                                                                container: 'custom-swal-container',
                                                                popup: 'custom-swal-popup',
                                                                closeButton: 'custom-swal-close'
                                                            },
                                                            buttonsStyling: false,
                                                            background: 'transparent',
                                                            backdrop: `
                                                                rgba(0,0,0,0.9)
                                                                url("data:image/svg+xml,%3Csvg width='80' height='80' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpolygon points='0,100 100,0 100,100' fill='%23000000' fill-opacity='.1'/%3E%3C/svg%3E")
                                                                right bottom
                                                                no-repeat
                                                            `,
                                                            showClass: {
                                                                popup: 'animate__animated animate__zoomIn animate__faster'
                                                            },
                                                            hideClass: {
                                                                popup: 'animate__animated animate__zoomOut animate__faster'
                                                            }
                                                        });
                                                    });
                                                });
                                            });
                                        </script>

                                        <style>
                                            .custom-swal-container {
                                                display: flex;
                                                justify-content: center;
                                                align-items: center;
                                            }

                                            .custom-swal-popup {
                                                background: transparent !important;
                                                box-shadow: none !important;
                                            }

                                            .custom-swal-close {
                                                position: fixed;
                                                top: 20px;
                                                right: 20px;
                                                width: 40px;
                                                height: 40px;
                                                font-size: 24px;
                                                color: #fff;
                                                background-color: rgba(255,255,255,0.2);
                                                border: 2px solid #fff;
                                                border-radius: 50%;
                                                display: flex;
                                                justify-content: center;
                                                align-items: center;
                                                transition: all 0.3s ease;
                                                z-index: 10;
                                            }

                                            .custom-swal-close:hover {
                                                background-color: rgba(255,255,255,0.4);
                                                transform: rotate(90deg);
                                            }

                                            .custom-image-modal {
                                                display: flex;
                                                flex-direction: column;
                                                align-items: center;
                                                max-width: 90vw;
                                                max-height: 90vh;
                                            }

                                            .image-wrapper {
                                                position: relative;
                                                overflow: hidden;
                                                border-radius: 15px;
                                                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                                                transition: transform 0.3s ease;
                                            }

                                            .image-wrapper:hover {
                                                transform: scale(1.02);
                                            }

                                            .image-wrapper::after {
                                                content: '';
                                                position: absolute;
                                                top: 0;
                                                left: 0;
                                                right: 0;
                                                bottom: 0;
                                                background: linear-gradient(to bottom, rgba(0,0,0,0.1), rgba(0,0,0,0.3));
                                                opacity: 0;
                                                transition: opacity 0.3s ease;
                                            }

                                            .image-wrapper:hover::after {
                                                opacity: 1;
                                            }

                                            .custom-image-modal img {
                                                display: block;
                                                max-width: 100%;
                                                max-height: 70vh;
                                                object-fit: contain;
                                            }

                                            .image-caption {
                                                margin-top: 20px;
                                                text-align: center;
                                                color: #fff;
                                            }

                                            .image-caption h3 {
                                                font-size: 24px;
                                                margin-bottom: 5px;
                                                text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
                                            }

                                            .image-caption p {
                                                font-size: 16px;
                                                opacity: 0.8;
                                            }

                                            @media (max-width: 768px) {
                                                .custom-image-modal {
                                                    max-width: 95vw;
                                                }
                                                .image-caption h3 {
                                                    font-size: 20px;
                                                }
                                                .image-caption p {
                                                    font-size: 14px;
                                                }
                                            }
                                        </style>


                            <h1 class="h2 text-white mb-0">{{ user.get_full_name }}</h1>
                            <h2 class="h4 fw-normal text-white-75">
                                {{ user.username }}
                            </h2>
                            <a class="btn btn-alt-secondary" href="{% url 'accounts:login_history' %}"> <i class="fa fa-fw fa-arrow-left text-danger"></i> Back to Profile </a>
                        </div>
                    </div>
                </div>

                <div class="content content-boxed">
                    {% if messages %}
                    <div class="block block-rounded">
                        <div class="block-content">
                            {% for message in messages %}
                            <div class="alert alert-{{ message.tags }}" role="alert">
                                {{ message }}
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}

                    <div class="block block-rounded">
                        <div class="block-header block-header-default">
                            <h3 class="block-title">User Profile</h3>
                        </div>
                        <div class="block-content">
                            <form method="POST" enctype="multipart/form-data">
                                {% csrf_token %}
                                <div class="row push">
                                    <div class="col-lg-4">
                                        <p class="fs-sm text-muted">
                                            Your account's vital info. Your username will be publicly visible.
                                        </p>
                                    </div>
                                    <div class="col-lg-8 col-xl-5">
                                        {% for field in user_form %}
                                        <div class="mb-4">
                                            <label class="form-label" for="{{ field.id_for_label }}">{{ field.label }}</label>
                                            {{ field }}
                                            {% if field.errors %}
                                            <div class="invalid-feedback d-block">
                                                {% for error in field.errors %}
                                                {{ error }}
                                                {% endfor %}
                                            </div>
                                            {% endif %}
                                        </div>
                                        {% endfor %}
                                        <div class="mb-4">
                                            <label class="form-label">Your Avatar</label>
                                            <div class="mb-4">
                                                <img class="img-avatar" src="{{ user.account.picture.url }}" alt="Current Avatar" />
                                            </div>
                                            <div class="mb-4">
                                                <label for="{{ account_form.picture.id_for_label }}" class="form-label">Choose a new avatar</label><br> <small style="font-size:10px;">Encrypted</small> 
                                                {{ account_form.picture }}
                                                {% if account_form.picture.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {% for error in account_form.picture.errors %}
                                                    {{ error }}
                                                    {% endfor %}
                                                </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="mb-4">
                                            <button type="submit" name="update_profile" class="btn btn-alt-primary">
                                                Update Profile
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="block block-rounded">
                        <div class="block-header block-header-default">
                            <h3 class="block-title">Change Password</h3>
                        </div>
                        <div class="block-content">
                            <form method="POST">
                                {% csrf_token %}
                                <div class="row push">
                                    <div class="col-lg-4">
                                        <p class="fs-sm text-muted">
                                            Changing your sign in password is an easy way to keep your account secure.
                                        </p>
                                    </div>
                                    <div class="col-lg-8 col-xl-5">
                                        {% for field in password_form %}
                                        <div class="mb-4">
                                            <label class="form-label" for="{{ field.id_for_label }}">{{ field.label }}</label>
                                            {{ field }}
                                            {% if field.errors %}
                                            <div class="invalid-feedback d-block">
                                                {% for error in field.errors %}
                                                {{ error }}
                                                {% endfor %}
                                            </div>
                                            {% endif %}
                                        </div>
                                        {% endfor %}
                                        <div class="mb-4">
                                            <button type="submit" name="change_password" class="btn btn-alt-primary">
                                                Change Password
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </main>
{% endblock %}